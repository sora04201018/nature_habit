<!-- ▼▼ マイページカード ▼▼ -->
<div class="w-full flex justify-center mt-10 mb-10 px-4">
  <div class="flex flex-col w-full max-w-md bg-white rounded-2xl shadow-lg p-6">

    <!-- タイトル -->
    <h2 class="text-2xl font-bold text-green-700 text-center mb-6">🌱 マイページ 🌱</h2>

    <!-- ユーザー情報 -->
    <p class="text-lg text-gray-800 mb-2">名前：<%= @user.name %></p>

    <!-- 編集ボタン -->
    <div class="flex flex-col mt-4">
      <%= link_to "編集", edit_user_registration_path,
          class: "inline-block w-full text-center bg-green-500 hover:bg-green-600 text-white font-semibold px-4 py-2 rounded-lg shadow" %>
      <!-- LINE友達追加ボタン -->
      <%= button_to line_notify_path, method: :post, data: { turbo: false },
          class: "mt-2 inline-flex items-center justify-center gap-2 w-full text-center text-green-500 border-2 border-green-500 hover:text-green-600 font-semibold px-4 py-2 rounded-lg shadow" do %>
        <%= image_tag "line_icon.png", alt: "LINE公式", class: "w-5 h-5" %>
        <span>LINEで友達追加</span>
      <% end %>

      <%= link_to "ダッシュボードへ戻る", dashboard_path,
          class: "inline-block font-semibold w-full mt-2 text-center text-gray-700 bg-white px-4 py-2 rounded-xl border-2 border-gray-400 hover:bg-gray-50 hover:text-gray-900 transition shadow" %>
    </div>

    <!-- 仕切り線 -->
    <hr class="w-full border-t border-gray-300 my-6">

    <!-- バッジ一覧タイトル -->
    <h3 class="text-lg font-semibold mb-4">🏅 獲得バッジ</h3>

    <!-- バッジグリッド -->
    <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 w-full">
      <% @user.badges.order(threshold: :asc).each do |badge| %>
        <div class="relative group flex flex-col items-center bg-white shadow-md p-4 rounded-xl border hover:scale-105 transition">

          <% if badge.icon.present? %>
            <%= image_tag badge.icon, class:"w-12 h-12 rounded-full object-cover mb-2" %>
          <% else %>
            <span class="w-12 h-12 flex items-center justify-center rounded-full bg-green-200 mb-2">🏅</span>
          <% end %>

          <div class="font-semibold text-center text-sm"><%= badge.name %></div>
          <!-- 🎈 Tooltip（説明ポップアップ） -->
          <div class="absolute bottom-full mb-2 hidden group-hover:block bg-gray-800 text-white text-xs rounded py-1 px-2 whitespace-nowrap shadow-lg z-10">
            <%= badge.description %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- バッジがない場合の表示 -->
    <% if @user.badges.empty? %>
        <p class="text-sm text-gray-500">まだバッジがありません。達成を重ねて獲得しましょう！</p>
    <% end %>

    <div class="text-sm text-gray-400 pt-5">
        <p>総達成回数：<%= @total_habit_checks_count %>回</p>
    </div>

    <!-- 仕切り線（未獲得バッジ用） -->
    <hr class="w-full border-t border-gray-300 my-6">

    <!-- 未獲得バッジ一覧タイトル -->
    <h3 class="text-lg font-semibold mb-4 text-gray-600">🔒 未獲得バッジ</h3>

    <!-- 未獲得バッジグリッド -->
    <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 w-full">
      <% @unowned_badges.order(threshold: :asc).each do |badge| %>
        <div class="relative group flex flex-col items-center bg-gray-200 shadow-inner p-4 rounded-xl border opacity-50">

          <% if badge.icon.present? %>
            <%= image_tag badge.icon, class:"w-12 h-12 rounded-full object-cover mb-2 grayscale" %>
          <% else %>
            <span class="w-12 h-12 flex items-center justify-center rounded-full bg-gray-300 mb-2">🏅</span>
          <% end %>

          <div class="font-semibold text-center text-sm text-gray-600"><%= badge.name %></div>

          <!-- Tooltip（説明ポップアップ） -->
          <div class="absolute bottom-full mb-2 hidden group-hover:block bg-gray-800 text-white text-xs rounded py-1 px-2 whitespace-nowrap shadow-lg z-10">
            <%= badge.description %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
